@model IEnumerable<FluorecerApp_Client.Entities.TestResultsEnt>

@{
    ViewBag.Title = "Tests Users";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row justify-content-center">
    <div class="col-11 mx-auto">
        <div class="text-md-left mt-3">
            <button onclick="goBackTo('@Url.Action("Index", "User")')" style="color: #4eaac8; text-decoration: none; background: none; border: none;">
                <i class="fas fa-arrow-left me-2"></i> Regresar
            </button>
        </div>
    </div>
</div>

<script>
    function goBackTo(destination) {
        window.location.href = destination;
    }
</script>

<div class="col-lg-12">
    <div class="feature-block d-lg-flex justify-content-center">

        @if (!string.IsNullOrEmpty(ViewBag.ResultMessage))
        {
            <div class="alert alert-success" role="alert">
                @ViewBag.ResultMessage
            </div>
        }

        @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
        {
            <div class="alert alert-danger" role="alert">
                @ViewBag.ErrorMessage
            </div>
        }
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-11 mx-auto">

        @if (ViewBag.MsjPantalla != null)
        {
            <div style="text-align:center" class="alert alert-warning" role="alert">
                @ViewBag.MsjPantalla
            </div>
        }

        <br>
        <h5>Evaluaciones de los Pacientes</h5>
        <br>

        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Nombre de la Evaluación</th>
                    <th>Descargar</th>
                    <th>Eliminar</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.FilePath</td>

                        <td>
                            <a href="@Url.Action("DownloadTestResult", "Test", new { resultId = item.ResultId })" class="btn btn-success">
                                <i class="fa fa-download"></i>
                            </a>
                        </td>
                        <td>
                            <form id="deleteForm_@item.ResultId" action="@Url.Action("DeleteTestResult", "Test", new { resultId = item.ResultId })" method="post">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-danger" data-result-id="@item.ResultId">
                                      <i class="fa fa-trash"></i>
                                </button>
                            </form>
                        </td>

                    </tr>
                }
            </tbody>
        </table>

    </div>
</div>

<script>
    // JavaScript para emular la solicitud DELETE
    document.querySelectorAll('.delete-button').forEach(function (button) {
        button.addEventListener('click', function (event) {
            event.preventDefault();
            var resultId = this.getAttribute('data-result-id');
            var form = document.getElementById('deleteForm_' + resultId);

            if (confirm('¿Estás seguro de que deseas eliminar esta evaluación?')) {
                form.submit();
            }
        });
    });
</script>
